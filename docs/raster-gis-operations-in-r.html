<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Raster GIS operations in R | A Minimal Introduction to GIS (in R)</title>
  <meta name="description" content="This is a minimal introduction to GIS and handling spatial data in R compiled for the Biological Sciences BSc(Honours) class at the University of Cape Town." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Raster GIS operations in R | A Minimal Introduction to GIS (in R)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal introduction to GIS and handling spatial data in R compiled for the Biological Sciences BSc(Honours) class at the University of Cape Town." />
  <meta name="github-repo" content="jslingsby/spatial-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Raster GIS operations in R | A Minimal Introduction to GIS (in R)" />
  
  <meta name="twitter:description" content="This is a minimal introduction to GIS and handling spatial data in R compiled for the Biological Sciences BSc(Honours) class at the University of Cape Town." />
  

<meta name="author" content="Jasper Slingsby" />


<meta name="date" content="2021-06-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rdemo.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Intro to GIS in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#general"><i class="fa fa-check"></i><b>1.1</b> General</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#using"><i class="fa fa-check"></i><b>1.2</b> Using this resource</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#module-and-project-details"><i class="fa fa-check"></i><b>1.3</b> Module and Project details</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Why care about GIS?</a></li>
<li class="chapter" data-level="3" data-path="gis-basics.html"><a href="gis-basics.html"><i class="fa fa-check"></i><b>3</b> GIS basics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="gis-basics.html"><a href="gis-basics.html#what-is-gis"><i class="fa fa-check"></i><b>3.1</b> What is GIS?</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="gis-basics.html"><a href="gis-basics.html#an-example-workflow"><i class="fa fa-check"></i><b>3.1.1</b> An example workflow</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="gis-basics.html"><a href="gis-basics.html#how-do-we-do-gis"><i class="fa fa-check"></i><b>3.2</b> How do we do GIS?</a></li>
<li class="chapter" data-level="3.3" data-path="gis-basics.html"><a href="gis-basics.html#ucthelp"><i class="fa fa-check"></i><b>3.3</b> How to get help?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gis-data-models-and-file-formats.html"><a href="gis-data-models-and-file-formats.html"><i class="fa fa-check"></i><b>4</b> GIS data models and file formats</a>
<ul>
<li class="chapter" data-level="4.1" data-path="gis-data-models-and-file-formats.html"><a href="gis-data-models-and-file-formats.html#data-models"><i class="fa fa-check"></i><b>4.1</b> Data models</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="gis-data-models-and-file-formats.html"><a href="gis-data-models-and-file-formats.html#vector-data"><i class="fa fa-check"></i><b>4.1.1</b> Vector data</a></li>
<li class="chapter" data-level="4.1.2" data-path="gis-data-models-and-file-formats.html"><a href="gis-data-models-and-file-formats.html#raster-data"><i class="fa fa-check"></i><b>4.1.2</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="gis-data-models-and-file-formats.html"><a href="gis-data-models-and-file-formats.html#attribute-data"><i class="fa fa-check"></i><b>4.2</b> Attribute data</a></li>
<li class="chapter" data-level="4.3" data-path="gis-data-models-and-file-formats.html"><a href="gis-data-models-and-file-formats.html#file-formats"><i class="fa fa-check"></i><b>4.3</b> File formats</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="some-important-concepts-and-pitfalls.html"><a href="some-important-concepts-and-pitfalls.html"><i class="fa fa-check"></i><b>5</b> Some important concepts and pitfalls</a>
<ul>
<li class="chapter" data-level="5.1" data-path="some-important-concepts-and-pitfalls.html"><a href="some-important-concepts-and-pitfalls.html#scale"><i class="fa fa-check"></i><b>5.1</b> Scale</a></li>
<li class="chapter" data-level="5.2" data-path="some-important-concepts-and-pitfalls.html"><a href="some-important-concepts-and-pitfalls.html#coordinate-reference-systems-crs"><i class="fa fa-check"></i><b>5.2</b> Coordinate Reference Systems (CRS)</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="some-important-concepts-and-pitfalls.html"><a href="some-important-concepts-and-pitfalls.html#geographic-or-unprojected-coordinate-systems"><i class="fa fa-check"></i><b>5.2.1</b> Geographic (or “unprojected”) Coordinate Systems</a></li>
<li class="chapter" data-level="5.2.2" data-path="some-important-concepts-and-pitfalls.html"><a href="some-important-concepts-and-pitfalls.html#projections"><i class="fa fa-check"></i><b>5.2.2</b> Projected Coordinate Systems</a></li>
<li class="chapter" data-level="5.2.3" data-path="some-important-concepts-and-pitfalls.html"><a href="some-important-concepts-and-pitfalls.html#projection-codes"><i class="fa fa-check"></i><b>5.2.3</b> Projection codes</a></li>
<li class="chapter" data-level="5.2.4" data-path="some-important-concepts-and-pitfalls.html"><a href="some-important-concepts-and-pitfalls.html#on-the-fly-vs-manual-projection"><i class="fa fa-check"></i><b>5.2.4</b> “On the fly” vs manual projection</a></li>
<li class="chapter" data-level="5.2.5" data-path="some-important-concepts-and-pitfalls.html"><a href="some-important-concepts-and-pitfalls.html#the-golden-rules"><i class="fa fa-check"></i><b>5.2.5</b> The golden rules…</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="r-as-a-gis.html"><a href="r-as-a-gis.html"><i class="fa fa-check"></i><b>6</b> R as a GIS</a>
<ul>
<li class="chapter" data-level="6.1" data-path="r-as-a-gis.html"><a href="r-as-a-gis.html#overview-1"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="r-as-a-gis.html"><a href="r-as-a-gis.html#some-key-r-packages"><i class="fa fa-check"></i><b>6.2</b> Some key R packages</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="r-as-a-gis.html"><a href="r-as-a-gis.html#for-vector-data"><i class="fa fa-check"></i><b>6.2.1</b> For vector data</a></li>
<li class="chapter" data-level="6.2.2" data-path="r-as-a-gis.html"><a href="r-as-a-gis.html#for-raster-data"><i class="fa fa-check"></i><b>6.2.2</b> For raster data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rdemo.html"><a href="rdemo.html"><i class="fa fa-check"></i><b>7</b> Vector GIS operations in R</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rdemo.html"><a href="rdemo.html#casestudy"><i class="fa fa-check"></i><b>7.1</b> Case study and demo datasets</a></li>
<li class="chapter" data-level="7.2" data-path="rdemo.html"><a href="rdemo.html#reading-and-writing"><i class="fa fa-check"></i><b>7.2</b> Reading and writing</a></li>
<li class="chapter" data-level="7.3" data-path="rdemo.html"><a href="rdemo.html#basic-plotting"><i class="fa fa-check"></i><b>7.3</b> Basic plotting</a></li>
<li class="chapter" data-level="7.4" data-path="rdemo.html"><a href="rdemo.html#cropping"><i class="fa fa-check"></i><b>7.4</b> Cropping</a></li>
<li class="chapter" data-level="7.5" data-path="rdemo.html"><a href="rdemo.html#select-and-subset-by-attribute"><i class="fa fa-check"></i><b>7.5</b> Select and subset by attribute</a></li>
<li class="chapter" data-level="7.6" data-path="rdemo.html"><a href="rdemo.html#combine-classes-and-dissolve-by-attribute"><i class="fa fa-check"></i><b>7.6</b> Combine classes and dissolve by attribute</a></li>
<li class="chapter" data-level="7.7" data-path="rdemo.html"><a href="rdemo.html#getinat"><i class="fa fa-check"></i><b>7.7</b> Calling iNaturalist locality (point) data from R</a></li>
<li class="chapter" data-level="7.8" data-path="rdemo.html"><a href="rdemo.html#converting-a-dataframe-into-a-spatial-object"><i class="fa fa-check"></i><b>7.8</b> Converting a dataframe into a spatial object</a></li>
<li class="chapter" data-level="7.9" data-path="rdemo.html"><a href="rdemo.html#adding-basemaps-to-plots"><i class="fa fa-check"></i><b>7.9</b> Adding basemaps to plots</a></li>
<li class="chapter" data-level="7.10" data-path="rdemo.html"><a href="rdemo.html#interactive-maps-with-leaflet"><i class="fa fa-check"></i><b>7.10</b> Interactive maps with <em>leaflet</em></a></li>
<li class="chapter" data-level="7.11" data-path="rdemo.html"><a href="rdemo.html#reprojecting"><i class="fa fa-check"></i><b>7.11</b> Reprojecting</a></li>
<li class="chapter" data-level="7.12" data-path="rdemo.html"><a href="rdemo.html#intersecting-points-and-polygons"><i class="fa fa-check"></i><b>7.12</b> Intersecting points and polygons</a></li>
<li class="chapter" data-level="7.13" data-path="rdemo.html"><a href="rdemo.html#colour-or-label-points"><i class="fa fa-check"></i><b>7.13</b> Colour or label points</a></li>
<li class="chapter" data-level="7.14" data-path="rdemo.html"><a href="rdemo.html#buffering"><i class="fa fa-check"></i><b>7.14</b> Buffering</a></li>
<li class="chapter" data-level="7.15" data-path="rdemo.html"><a href="rdemo.html#within-distance-and-intersect"><i class="fa fa-check"></i><b>7.15</b> Within distance and intersect</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html"><i class="fa fa-check"></i><b>8</b> Raster GIS operations in R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#reading-in-data"><i class="fa fa-check"></i><b>8.1</b> Reading in data</a></li>
<li class="chapter" data-level="8.2" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#cropping-1"><i class="fa fa-check"></i><b>8.2</b> Cropping</a></li>
<li class="chapter" data-level="8.3" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#aggregating-resampling"><i class="fa fa-check"></i><b>8.3</b> Aggregating / Resampling</a></li>
<li class="chapter" data-level="8.4" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#basic-plotting-1"><i class="fa fa-check"></i><b>8.4</b> Basic plotting</a></li>
<li class="chapter" data-level="8.5" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#disaggregating"><i class="fa fa-check"></i><b>8.5</b> Disaggregating</a></li>
<li class="chapter" data-level="8.6" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#raster-maths"><i class="fa fa-check"></i><b>8.6</b> Raster maths!</a></li>
<li class="chapter" data-level="8.7" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#terrain-calculations"><i class="fa fa-check"></i><b>8.7</b> Terrain calculations</a></li>
<li class="chapter" data-level="8.8" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#raster-stacks"><i class="fa fa-check"></i><b>8.8</b> Raster stacks</a></li>
<li class="chapter" data-level="8.9" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#extracting-raster-to-vector"><i class="fa fa-check"></i><b>8.9</b> Extracting raster to vector</a></li>
<li class="chapter" data-level="8.10" data-path="raster-gis-operations-in-r.html"><a href="raster-gis-operations-in-r.html#rasterizing"><i class="fa fa-check"></i><b>8.10</b> Rasterizing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal Introduction to GIS (in R)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="raster-gis-operations-in-r" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Raster GIS operations in R</h1>
<div id="reading-in-data" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Reading in data</h2>
<p>Ok, now to look at handling rasters. As with <em>sf</em>, the <em>raster</em> package has one function (<code>raster()</code>) that can read in just about any raster file format. Let’s get started and read in the digital elevation model (DEM) for the City of Cape Town.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="raster-gis-operations-in-r.html#cb86-1" aria-hidden="true" tabindex="-1"></a>dem <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;/home/jasper/Documents/Datasets/CoCT/10m_Grid_GeoTiff/10m_BA.tif&quot;</span>)</span>
<span id="cb86-2"><a href="raster-gis-operations-in-r.html#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="raster-gis-operations-in-r.html#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dem)</span></code></pre></div>
<pre><code>## [1] &quot;RasterLayer&quot;
## attr(,&quot;package&quot;)
## [1] &quot;raster&quot;</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="raster-gis-operations-in-r.html#cb88-1" aria-hidden="true" tabindex="-1"></a>dem <span class="co">#Typing the name of a &quot;raster&quot; class data object gives you the details</span></span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 9902, 6518, 64541236  (nrow, ncol, ncell)
## resolution : 10, 10  (x, y)
## extent     : -64180, 1000, -3804020, -3705000  (xmin, xmax, ymin, ymax)
## crs        : +proj=tmerc +lat_0=0 +lon_0=19 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## source     : /home/jasper/Documents/Datasets/CoCT/10m_Grid_GeoTiff/10m_BA.tif 
## names      : X10m_BA 
## values     : -32768, 32767  (min, max)</code></pre>
<p>From the <em>proj4string</em> we can see that the coordinate reference system is Transverse Mercator Lo19. If you just want to know the CRS from a raster, you just call the <em>proj4string</em> like so:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="raster-gis-operations-in-r.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(dem)</span></code></pre></div>
<pre><code>## [1] &quot;+proj=tmerc +lat_0=0 +lon_0=19 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;</code></pre>
<p>Similar to <code>st_crs()</code>, you can define a projection using the syntax <code>proj4string(your_raster) &lt;- "your_proj4string"</code>. For reprojecting, you use the function <code>projectRaster()</code>. We’ll look at it later.</p>
<p><br></p>
</div>
<div id="cropping-1" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Cropping</h2>
<p>Ok, before we try to anything with this dataset, let’s think about how big it is… One of the outputs of calling <code>dem</code> was the row reading <code>dimensions : 9902, 6518, 64541236  (nrow, ncol, ncell)</code>. Given that we are talking about 10m pixels, this information tells us that the extent of the region is roughly 100km by 65km and that there are ~65 million pixels! No wonder the file is ~130MB. While R can handle this, it will be slow! There are many ways to improve the efficiency of handling big rasters in R (see <a href="https://www.ecologi.st/post/big-spatial-data/">this post for details</a> if you’re interested), but for the purposes of this tutorial we’re going to take the easy option and just crop it to a smaller extent, like so:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="raster-gis-operations-in-r.html#cb92-1" aria-hidden="true" tabindex="-1"></a>dem <span class="ot">&lt;-</span> <span class="fu">crop</span>(dem, <span class="fu">extent</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">66642.18</span>, <span class="sc">-</span><span class="fl">44412.18</span>, <span class="sc">-</span><span class="fl">3809853.29</span>, <span class="sc">-</span><span class="fl">3750723.29</span>)))</span></code></pre></div>
<p>Note that the <code>crop()</code> function requires us to pass it an object of class <code>extent</code>. Just like <code>st_crop()</code> from <em>sf</em>, <code>crop()</code> can derive the extent from another data object. One silly difference, is that if you pass it the coordinates of the extent manually (as above), you first need to pass it to the <code>extent()</code> function, and they need to follow the order <em>xmin, xmax, ymin, ymax</em> (as opposed to <em>xmin, ymin, xmax, ymax</em> as you do for <code>st_crop()</code>). Keep your eye out for these little differences, because they will trip you up…</p>
<p>Ok, so how big is our dataset now?</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="raster-gis-operations-in-r.html#cb93-1" aria-hidden="true" tabindex="-1"></a>dem</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 5330, 1977, 10537410  (nrow, ncol, ncell)
## resolution : 10, 10  (x, y)
## extent     : -64180, -44410, -3804020, -3750720  (xmin, xmax, ymin, ymax)
## crs        : +proj=tmerc +lat_0=0 +lon_0=19 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## source     : memory
## names      : X10m_BA 
## values     : -15, 1084  (min, max)</code></pre>
<p>…still &gt;10 million pixels…</p>
<p><br></p>
</div>
<div id="aggregating-resampling" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Aggregating / Resampling</h2>
<p>Do we need 10m data? If your analysis doesn’t need such fine resolution data, you can resample the raster to a larger pixel size, like 30m. The <code>aggregate()</code> function in the <em>raster</em> package does this very efficiently, like so:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="raster-gis-operations-in-r.html#cb95-1" aria-hidden="true" tabindex="-1"></a>dem30 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(dem, <span class="at">fact =</span> <span class="dv">3</span>, <span class="at">fun =</span> mean)</span></code></pre></div>
<p>Here I’ve told it to aggregate by a factor of 3 (i.e. bin 9 neighbouring pixels (3x3) into one) and to assign the bigger pixel the mean of the 9 original pixels. This obviously results in some data loss, but that can be acceptable, depending on the purpose of your analysis. Note that you can pass just about any function to <code>fun =</code>, like <code>min()</code>, <code>max()</code> or even your own function.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="raster-gis-operations-in-r.html#cb96-1" aria-hidden="true" tabindex="-1"></a>dem30</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 1777, 659, 1171043  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : -64180, -44410, -3804030, -3750720  (xmin, xmax, ymin, ymax)
## crs        : +proj=tmerc +lat_0=0 +lon_0=19 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## source     : memory
## names      : X10m_BA 
## values     : -15, 1083.556  (min, max)</code></pre>
<p>Ok, so we’ve reduced the size of the raster by a factor of 9 and only have a little over 1 million pixels to deal with. Much more reasonable! Now let’s have a look at what we’re dealing with.</p>
<p><br></p>
</div>
<div id="basic-plotting-1" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Basic plotting</h2>
<p>Now that we’ve reduced the size of the dataset, we can try the base plotting function:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="raster-gis-operations-in-r.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dem30)</span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>Or with the <em>Tidyverse</em>…</p>
<p>But <code>ggplot()</code> doesn’t accept rasters, so we need it a dataframe with <em>x</em> and <em>y</em> columns for the coordinates, and a column containing the values to plot. This is easily done, firstly by converting the raster to a vector layer of points, and then by coorcing that into a dataframe, like so:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="raster-gis-operations-in-r.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#convert to points</span></span>
<span id="cb99-2"><a href="raster-gis-operations-in-r.html#cb99-2" aria-hidden="true" tabindex="-1"></a>dem30df <span class="ot">&lt;-</span> <span class="fu">rasterToPoints</span>(dem30, <span class="at">spatial =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-3"><a href="raster-gis-operations-in-r.html#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="raster-gis-operations-in-r.html#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dem30df) <span class="co">#note that this is a class from library(sp)</span></span></code></pre></div>
<pre><code>## [1] &quot;SpatialPointsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="raster-gis-operations-in-r.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">#coerce to a dataframe</span></span>
<span id="cb101-2"><a href="raster-gis-operations-in-r.html#cb101-2" aria-hidden="true" tabindex="-1"></a>dem30df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dem30df)</span>
<span id="cb101-3"><a href="raster-gis-operations-in-r.html#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="raster-gis-operations-in-r.html#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dem30df)</span></code></pre></div>
<pre><code>## [1] &quot;X10m_BA&quot;  &quot;x&quot;        &quot;y&quot;       
## [4] &quot;optional&quot;</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="raster-gis-operations-in-r.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#call tidyverse libraries and plot</span></span>
<span id="cb103-2"><a href="raster-gis-operations-in-r.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb103-3"><a href="raster-gis-operations-in-r.html#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="raster-gis-operations-in-r.html#cb103-4" aria-hidden="true" tabindex="-1"></a>dem30df <span class="sc">%&gt;%</span></span>
<span id="cb103-5"><a href="raster-gis-operations-in-r.html#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb103-6"><a href="raster-gis-operations-in-r.html#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> X10m_BA))</span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-47-1.png" width="336" /></p>
<p>Ok, how different does our 30m raster look to the 10m version?</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="raster-gis-operations-in-r.html#cb104-1" aria-hidden="true" tabindex="-1"></a>demdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rasterToPoints</span>(dem, <span class="at">spatial =</span> <span class="cn">TRUE</span>))</span>
<span id="cb104-2"><a href="raster-gis-operations-in-r.html#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="raster-gis-operations-in-r.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(demdf)</span></code></pre></div>
<pre><code>## [1] &quot;X10m_BA&quot;  &quot;x&quot;        &quot;y&quot;       
## [4] &quot;optional&quot;</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="raster-gis-operations-in-r.html#cb106-1" aria-hidden="true" tabindex="-1"></a>demdf <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="raster-gis-operations-in-r.html#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb106-3"><a href="raster-gis-operations-in-r.html#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> X10m_BA))</span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-48-1.png" width="336" /></p>
<p>Not noticeably different at this scale!</p>
<p><br></p>
</div>
<div id="disaggregating" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Disaggregating</h2>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="raster-gis-operations-in-r.html#cb107-1" aria-hidden="true" tabindex="-1"></a>dem10 <span class="ot">&lt;-</span> <span class="fu">disaggregate</span>(dem30, <span class="at">fact =</span> <span class="dv">3</span>, <span class="at">method =</span> <span class="st">&quot;bilinear&quot;</span>)</span></code></pre></div>
<p>One way to explore the degree of data loss is to <code>disaggregate()</code> our 30m DEM back to 10m and then compare it to the original.</p>
<p>Note that I’ve tried to use <em>bilinear interpolation</em> to give it a fair chance of getting nearer the original values.</p>
<p>Now, how can I compare my two 10m rasters?</p>
<p><br></p>
</div>
<div id="raster-maths" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Raster maths!</h2>
<p>The <em>raster</em> package makes this easy, because you can do maths with rasters, treating tham as variables in an equation. So we can calculate the data loss as the difference between the original and disaggregated DEMS, like so.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="raster-gis-operations-in-r.html#cb108-1" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">&lt;-</span> dem <span class="sc">-</span> dem10</span></code></pre></div>
<pre><code>## Warning in dem - dem10: Raster objects
## have different extents. Result for their
## intersection is returned</code></pre>
<p>Note that the error is because we lost some of the 10m cells along the edged when we aggregated…</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="raster-gis-operations-in-r.html#cb110-1" aria-hidden="true" tabindex="-1"></a>diffdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rasterToPoints</span>(diff, <span class="at">spatial =</span> <span class="cn">TRUE</span>))</span>
<span id="cb110-2"><a href="raster-gis-operations-in-r.html#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="raster-gis-operations-in-r.html#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(diffdf)</span></code></pre></div>
<pre><code>## [1] &quot;layer&quot;    &quot;x&quot;        &quot;y&quot;       
## [4] &quot;optional&quot;</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="raster-gis-operations-in-r.html#cb112-1" aria-hidden="true" tabindex="-1"></a>diffdf <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href="raster-gis-operations-in-r.html#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb112-3"><a href="raster-gis-operations-in-r.html#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> layer))</span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-51-1.png" width="336" /></p>
<p>If you look <em>really</em> closely, you’ll see the outline of the cliffs of Table Mountain, where you’d expect the data loss to be worst. The colour ramp tells us that the worst distortion was up to 100m, or about 10% of the elevation range in this dataset, but don’t be fooled by the extremes! Let’s have a look at all the values as a histogram.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="raster-gis-operations-in-r.html#cb113-1" aria-hidden="true" tabindex="-1"></a>diffdf <span class="sc">%&gt;%</span></span>
<span id="cb113-2"><a href="raster-gis-operations-in-r.html#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb113-3"><a href="raster-gis-operations-in-r.html#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(layer))</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better
## value with `binwidth`.</code></pre>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<p>Looks like most values are within 10 or so metres of their original values, so the data loss really wasn’t that bad!</p>
<p><br></p>
</div>
<div id="terrain-calculations" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> Terrain calculations</h2>
<p>In addition to raster maths with multiple rasters, you can do all kinds of calculations within a raster using <code>focal()</code>. This essentially applies a moving window, calculating values for a neighbourhood of cells using whatever function you supplied (mean, max, your own, etc) as it goes.</p>
<p>The function <code>terrain()</code> is a special case of <code>focal()</code> optimized for calculating <em>slope, aspect, topographic position index (TPI), topographic roughness index (TRI), roughness, or flow direction</em>.</p>
<p>Here I’ll calculate the slope and aspect so that we can pass them to the function <code>hillShade()</code> to make a pretty hillshade layer.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="raster-gis-operations-in-r.html#cb115-1" aria-hidden="true" tabindex="-1"></a>aspect <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem30, <span class="st">&quot;aspect&quot;</span>)</span>
<span id="cb115-2"><a href="raster-gis-operations-in-r.html#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="raster-gis-operations-in-r.html#cb115-3" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fu">terrain</span>(dem30, <span class="st">&quot;slope&quot;</span>)</span>
<span id="cb115-4"><a href="raster-gis-operations-in-r.html#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="raster-gis-operations-in-r.html#cb115-5" aria-hidden="true" tabindex="-1"></a>hillshade <span class="ot">&lt;-</span> <span class="fu">hillShade</span>(slope, aspect)</span>
<span id="cb115-6"><a href="raster-gis-operations-in-r.html#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="raster-gis-operations-in-r.html#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hillshade)</span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>Probably prettier with <em>Tidyverse</em>:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="raster-gis-operations-in-r.html#cb116-1" aria-hidden="true" tabindex="-1"></a>hsdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rasterToPoints</span>(hillshade, <span class="at">spatial =</span> <span class="cn">TRUE</span>))</span>
<span id="cb116-2"><a href="raster-gis-operations-in-r.html#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="raster-gis-operations-in-r.html#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hsdf)</span></code></pre></div>
<pre><code>## [1] &quot;layer&quot;    &quot;x&quot;        &quot;y&quot;       
## [4] &quot;optional&quot;</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="raster-gis-operations-in-r.html#cb118-1" aria-hidden="true" tabindex="-1"></a>hsdf <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="raster-gis-operations-in-r.html#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb118-3"><a href="raster-gis-operations-in-r.html#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> layer)) <span class="sc">+</span></span>
<span id="cb118-4"><a href="raster-gis-operations-in-r.html#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;grey10&quot;</span>, <span class="at">high =</span> <span class="st">&quot;grey90&quot;</span>)</span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-54-1.png" width="336" /></p>
</div>
<div id="raster-stacks" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> Raster stacks</h2>
<p>A nice thing about rasters is that if you have multiple rasters “on the same grid” (i.e. with the same pixel size, extent and CRS) then you can <em>stack</em> them and work with them as a single <em>rasterstack</em> object.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="raster-gis-operations-in-r.html#cb119-1" aria-hidden="true" tabindex="-1"></a>dstack <span class="ot">&lt;-</span> <span class="fu">stack</span>(dem30, slope, aspect, hillshade)</span>
<span id="cb119-2"><a href="raster-gis-operations-in-r.html#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="raster-gis-operations-in-r.html#cb119-3" aria-hidden="true" tabindex="-1"></a>dstack</span></code></pre></div>
<pre><code>## class      : RasterStack 
## dimensions : 1777, 659, 1171043, 4  (nrow, ncol, ncell, nlayers)
## resolution : 30, 30  (x, y)
## extent     : -64180, -44410, -3804030, -3750720  (xmin, xmax, ymin, ymax)
## crs        : +proj=tmerc +lat_0=0 +lon_0=19 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names      :      X10m_BA,        slope,       aspect,        layer 
## min values :  -15.0000000,    0.0000000,    0.0000000,   -0.4906481 
## max values : 1083.5555556,    1.3708258,    6.2831853,    0.9999974</code></pre>
<p>As you can see the “dimensions” now report 4 layers, and there are 4 names. Some of these don’t look all that informative though, so let’s rename them.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="raster-gis-operations-in-r.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dstack) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;elevation&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;aspect&quot;</span>, <span class="st">&quot;shade&quot;</span>)</span></code></pre></div>
<p><br></p>
</div>
<div id="extracting-raster-to-vector" class="section level2" number="8.9">
<h2><span class="header-section-number">8.9</span> Extracting raster to vector</h2>
<p>Ok, enough fooling around. More often than not, we just want to extract data from rasters for further analyses (e.g. climate layers, etc), so let’s cover that base here.</p>
<p><br></p>
<p><strong>Extract to points</strong></p>
<p>First, let’s get some points for two species in the Proteaceae, <em>Protea cynaroides</em> and <em>Leucospermum conocarpodendron</em>…</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="raster-gis-operations-in-r.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rinat)</span>
<span id="cb122-2"><a href="raster-gis-operations-in-r.html#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="raster-gis-operations-in-r.html#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Call data for two species directly from iNat</span></span>
<span id="cb122-4"><a href="raster-gis-operations-in-r.html#cb122-4" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">get_inat_obs</span>(<span class="at">taxon_name =</span> <span class="st">&quot;Protea cynaroides&quot;</span>,</span>
<span id="cb122-5"><a href="raster-gis-operations-in-r.html#cb122-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bounds =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">35</span>, <span class="dv">18</span>, <span class="sc">-</span><span class="fl">33.5</span>, <span class="fl">18.5</span>),</span>
<span id="cb122-6"><a href="raster-gis-operations-in-r.html#cb122-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">maxresults =</span> <span class="dv">1000</span>)</span>
<span id="cb122-7"><a href="raster-gis-operations-in-r.html#cb122-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-8"><a href="raster-gis-operations-in-r.html#cb122-8" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span> <span class="fu">get_inat_obs</span>(<span class="at">taxon_name =</span> <span class="st">&quot;Leucadendron laureolum&quot;</span>,</span>
<span id="cb122-9"><a href="raster-gis-operations-in-r.html#cb122-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">bounds =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">35</span>, <span class="dv">18</span>, <span class="sc">-</span><span class="fl">33.5</span>, <span class="fl">18.5</span>),</span>
<span id="cb122-10"><a href="raster-gis-operations-in-r.html#cb122-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">maxresults =</span> <span class="dv">1000</span>)</span>
<span id="cb122-11"><a href="raster-gis-operations-in-r.html#cb122-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-12"><a href="raster-gis-operations-in-r.html#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Combine the records into one dataframe</span></span>
<span id="cb122-13"><a href="raster-gis-operations-in-r.html#cb122-13" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pc,ll)</span>
<span id="cb122-14"><a href="raster-gis-operations-in-r.html#cb122-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-15"><a href="raster-gis-operations-in-r.html#cb122-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Filter returned observations by a range of attribute criteria</span></span>
<span id="cb122-16"><a href="raster-gis-operations-in-r.html#cb122-16" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> pc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(positional_accuracy<span class="sc">&lt;</span><span class="dv">46</span> <span class="sc">&amp;</span> </span>
<span id="cb122-17"><a href="raster-gis-operations-in-r.html#cb122-17" aria-hidden="true" tabindex="-1"></a>                latitude<span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb122-18"><a href="raster-gis-operations-in-r.html#cb122-18" aria-hidden="true" tabindex="-1"></a>                <span class="sc">!</span><span class="fu">is.na</span>(latitude) <span class="sc">&amp;</span></span>
<span id="cb122-19"><a href="raster-gis-operations-in-r.html#cb122-19" aria-hidden="true" tabindex="-1"></a>                captive_cultivated <span class="sc">==</span> <span class="st">&quot;false&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb122-20"><a href="raster-gis-operations-in-r.html#cb122-20" aria-hidden="true" tabindex="-1"></a>                quality_grade <span class="sc">==</span> <span class="st">&quot;research&quot;</span>)</span>
<span id="cb122-21"><a href="raster-gis-operations-in-r.html#cb122-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-22"><a href="raster-gis-operations-in-r.html#cb122-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Make the dataframe a spatial object of class = &quot;sf&quot;</span></span>
<span id="cb122-23"><a href="raster-gis-operations-in-r.html#cb122-23" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(pc, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span></code></pre></div>
<p>Now let’s extract the data to the points.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="raster-gis-operations-in-r.html#cb123-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">extract</span>(dem30, pc)</span></code></pre></div>
<pre><code>## Warning in .local(x, y, ...): Transforming
## SpatialPoints to the CRS of the Raster</code></pre>
<p>Note how <em>raster</em> conveniently handled my oversight about making sure the CRS are the same for both layers!</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="raster-gis-operations-in-r.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code></pre></div>
<pre><code>## [1] 704.5556 462.0000 516.4444 454.3333
## [5] 456.7778 701.0000</code></pre>
<p>Hmm… ok… It just returned the vector of numbers… not all that handy on it’s own. Let’s add it to out points layer and plot.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="raster-gis-operations-in-r.html#cb127-1" aria-hidden="true" tabindex="-1"></a>pc<span class="sc">$</span>dem30 <span class="ot">&lt;-</span> dat</span>
<span id="cb127-2"><a href="raster-gis-operations-in-r.html#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="raster-gis-operations-in-r.html#cb127-3" aria-hidden="true" tabindex="-1"></a>pc <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb127-4"><a href="raster-gis-operations-in-r.html#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(scientific_name, dem30))</span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>(Hmm… do you think those <em>Leucadendron laureolum</em> outliers could actually be <em>Leucadendron strobilinum</em>?)</p>
<p>Nice! But what if we have data lots of rasters?</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="raster-gis-operations-in-r.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#extract from stack</span></span>
<span id="cb128-2"><a href="raster-gis-operations-in-r.html#cb128-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">extract</span>(dstack, pc) </span></code></pre></div>
<pre><code>## Warning in .local(x, y, ...): Transforming
## SpatialPoints to the CRS of the Raster</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="raster-gis-operations-in-r.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#bind columns to points</span></span>
<span id="cb130-2"><a href="raster-gis-operations-in-r.html#cb130-2" aria-hidden="true" tabindex="-1"></a>edat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">as.data.frame</span>(pc), dat)</span>
<span id="cb130-3"><a href="raster-gis-operations-in-r.html#cb130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-4"><a href="raster-gis-operations-in-r.html#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="co">#select columns we want and tidy data into long format</span></span>
<span id="cb130-5"><a href="raster-gis-operations-in-r.html#cb130-5" aria-hidden="true" tabindex="-1"></a>edat <span class="ot">&lt;-</span> edat <span class="sc">%&gt;%</span> </span>
<span id="cb130-6"><a href="raster-gis-operations-in-r.html#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb130-7"><a href="raster-gis-operations-in-r.html#cb130-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(scientific_name, elevation, slope, aspect, shade) <span class="sc">%&gt;%</span> </span>
<span id="cb130-8"><a href="raster-gis-operations-in-r.html#cb130-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(elevation, slope, aspect, shade))</span>
<span id="cb130-9"><a href="raster-gis-operations-in-r.html#cb130-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-10"><a href="raster-gis-operations-in-r.html#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="co">#panel boxplot of the variables extracted</span></span>
<span id="cb130-11"><a href="raster-gis-operations-in-r.html#cb130-11" aria-hidden="true" tabindex="-1"></a>edat <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb130-12"><a href="raster-gis-operations-in-r.html#cb130-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(scientific_name, value)) <span class="sc">+</span></span>
<span id="cb130-13"><a href="raster-gis-operations-in-r.html#cb130-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) </span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<p><br></p>
<p>Something I should have mentioned is that if you would like each point to sample a larger region you can add a <code>buffer =</code> argument to the <code>extract()</code> function, and a function (<code>fun =</code>) to summarize the neighbourhood of pixels sampled, like so:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="raster-gis-operations-in-r.html#cb131-1" aria-hidden="true" tabindex="-1"></a>pc<span class="sc">$</span>dem30 <span class="ot">&lt;-</span> <span class="fu">extract</span>(dem30, pc, <span class="at">buffer =</span> <span class="dv">200</span>, <span class="at">fun =</span> mean)</span></code></pre></div>
<pre><code>## Warning in .local(x, y, ...): Transforming
## SpatialPoints to the CRS of the Raster</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="raster-gis-operations-in-r.html#cb133-1" aria-hidden="true" tabindex="-1"></a>pc <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb133-2"><a href="raster-gis-operations-in-r.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(scientific_name, dem30))</span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p><strong>Extract to polygons</strong></p>
<ul>
<li>binning</li>
</ul>
<p><br></p>
</div>
<div id="rasterizing" class="section level2" number="8.10">
<h2><span class="header-section-number">8.10</span> Rasterizing</h2>
<p>We could even add contours…</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="raster-gis-operations-in-r.html#cb134-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb134-2"><a href="raster-gis-operations-in-r.html#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> hsdf, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> layer, <span class="at">alpha =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb134-3"><a href="raster-gis-operations-in-r.html#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;grey10&quot;</span>, <span class="at">high =</span> <span class="st">&quot;grey90&quot;</span>) <span class="sc">+</span></span>
<span id="cb134-4"><a href="raster-gis-operations-in-r.html#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">data =</span> dem30df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">z =</span> X10m_BA), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1100</span>, <span class="dv">100</span>), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb134-5"><a href="raster-gis-operations-in-r.html#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="spatial-r_files/figure-html/unnamed-chunk-63-1.png" width="336" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rdemo.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jslingsby/spatial-r/edit/master/07-raster.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/jslingsby/spatial-r/blob/master/07-raster.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
